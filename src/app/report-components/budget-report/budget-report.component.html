<div class="container-fluid view-area">
  <block-ui>
    <div class="row">
      <div class="col-md-12">
        <ul class="nav nav-tabs">
          <li class="nav-item">
            <a class="nav-link active btn-info" data-toggle="tab">Budget report</a>
          </li>
        </ul>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="card-body">
            <form class="form-signin" (ngSubmit)="getBudgetReport()" #searchForm="ngForm">

              <div class="row margin-top-10">
                <div class="col-md-6 form-inline">
                  <label>Currency: </label>&nbsp;&nbsp;
                  <select [class.disable]="manualExRate == 0" class="form-control" (change)="selectCurrency()"
                    id="selectedCurrency" [(ngModel)]="model.selectedCurrency" name="selectedCurrency"
                    #selectedCurrency="ngModel">
                    <option *ngFor="let currency of currenciesList" value="{{currency.currency}}">
                      {{currency.currencyName}}
                    </option>
                  </select>&nbsp;
                  <span *ngIf="manualExRate > 0 && model.selectedCurrency == nationalCurrencyName" class="text-warning">
                    <b><i>Exchange rate: 1 USD = {{manualExRate}} {{nationalCurrencyName}} on {{datedToday}}</i></b>
                  </span>
                  <span *ngIf="manualExRate != 0 && model.selectedCurrency == defaultCurrency" class="text-warning">
                    <b><i>Exchange rate: 1 USD = 1 {{defaultCurrency}} on {{datedToday}}</i></b>
                  </span>
                  <span *ngIf="manualExRate == 0" class="text-danger">
                    <i>No exchange rate available, contact Administrator.</i>
                  </span>
                </div>
                <div class="col-md-6">
                  <span [class.disable]="!defaultCurrency" class="float-right">
                    <button type="submit" class="btn btn-info">Get Report</button>&nbsp;
                    <!--<button type="button" class="btn btn-primary" (click)="generatePDF()">Get PDF</button>&nbsp;-->
                    <button *ngIf="reportDataList && reportDataList.projects" type="button" class="btn btn-warning"
                      (click)="printReport()">Print Report</button>
                  </span>
                </div>
                <div *ngIf="!defaultCurrency" class="col-md-12">
                  <span class="text-danger">
                    Default currency is not set and it may produce errors on reports.
                    Please contact administrator.
                  </span>
                </div>
              </div>

            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="row margin-top-10" id="rpt-budget-report">
      <div *ngIf="reportDataList && reportDataList.reportSettings" class="col-md-12 text-center">
        <h5>{{reportDataList.reportSettings.title}} <small>(Currency: {{this.selectedCurrencyName}})</small></h5>
      </div>
    
      <div class="col-md-12">
    
        <div *ngIf="reportDataList && reportDataList.projects" class="margin-bottom-none">
          <div *ngFor="let project of reportDataList.projects; let i = index;">
            <span class="float-left lead">{{project.title}}</span><hr />
            
            <table class="table table-striped table-condensed small margin-bottom-none">
              <thead>
                <tr>
                    <th width="30%">Funder</th>
                    <th width="10%">Type</th>
                    <th width="15%">Amount</th>
                    <th width="10%">Currency</th>
                    <th width="15%">Xrate to default</th>
                    <th width="20%">Amount default</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let funder of project.funding">
                  <td>{{funder.funder}}</td>
                  <td>{{funder.fundType}}</td>
                  <td>{{funder.amount}}</td>
                  <td>{{funder.currency}}</td>
                  <td>{{funder.exchangeRateToDefault}}</td>
                  <td>{{funder.AmountInDefault}}</td>
                </tr>
                <tr>
                  <td colspan="6">&nbsp;</td>
                </tr>
                <tr>
                  <td>Project start</td>
                  <td>{{funder.startDateString}}</td>
                  <td>Project end</td>
                  <td>{{funder.endDateString}}</td>
                  <td>Total months</td>
                  <td>{{project.totalMonths}}</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
    
      </div>
    </div>

  </block-ui>
</div>

<error-modal message={{errorMessage}}></error-modal>