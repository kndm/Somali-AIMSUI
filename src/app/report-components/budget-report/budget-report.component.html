<div class="container-fluid view-area">
  <block-ui>
    <div class="row">
      <div class="col-md-12">
        <ul class="nav nav-tabs">
          <li class="nav-item">
            <a class="nav-link active btn-info" data-toggle="tab">Budget report</a>
          </li>
        </ul>
      </div>
    </div>

    <div class="row">
      <div class="col-md-12">
        <div class="card">
          <div class="card-body">
            <form class="form-signin" (ngSubmit)="getBudgetReport()" #searchForm="ngForm">

              <div class="row margin-top-10">
                <div class="col-md-6 form-inline">
                  <label>Currency: </label>&nbsp;&nbsp;
                  <select [class.disable]="manualExRate == 0" class="form-control" (change)="selectCurrency()"
                    id="selectedCurrency" [(ngModel)]="model.selectedCurrency" name="selectedCurrency"
                    #selectedCurrency="ngModel">
                    <option *ngFor="let currency of currenciesList" value="{{currency.currency}}">
                      {{currency.currencyName}}
                    </option>
                  </select>&nbsp;
                  <span *ngIf="manualExRate > 0 && model.selectedCurrency == nationalCurrencyName" class="text-warning">
                    <b><i>Exchange rate: 1 USD = {{manualExRate}} {{nationalCurrencyName}} on {{datedToday}}</i></b>
                  </span>
                  <span *ngIf="manualExRate != 0 && model.selectedCurrency == defaultCurrency" class="text-warning">
                    <b><i>Exchange rate: 1 USD = 1 {{defaultCurrency}} on {{datedToday}}</i></b>
                  </span>
                  <span *ngIf="manualExRate == 0" class="text-danger">
                    <i>No exchange rate available, contact Administrator.</i>
                  </span>
                </div>
                <div class="col-md-6">
                  <span [class.disable]="!defaultCurrency" class="float-right">
                    <button type="submit" class="btn btn-info">Get Report</button>&nbsp;
                    <!--<button type="button" class="btn btn-primary" (click)="generatePDF()">Get PDF</button>&nbsp;-->
                    <button *ngIf="reportDataList && reportDataList.projects" type="button" class="btn btn-warning"
                      (click)="printReport()">Print Report</button>
                  </span>
                </div>
                <div *ngIf="!defaultCurrency" class="col-md-12">
                  <span class="text-danger">
                    Default currency is not set and it may produce errors on reports.
                    Please contact administrator.
                  </span>
                </div>
              </div>

            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="row margin-top-10" id="rpt-budget-report">
      <div *ngIf="reportDataList && reportDataList.reportSettings" class="col-md-12 text-center">
        <h5>{{reportDataList.reportSettings.title}} <small>(Currency: {{this.selectedCurrencyName}})</small></h5>
      </div>
    
      <div class="col-md-12">
    
        <div *ngIf="reportDataList && reportDataList.projects" class="margin-bottom-none">
          <div *ngFor="let project of reportDataList.projects; let i = index;">
            <span class="float-left lead"><b>{{project.title}}</b></span><hr />
            
            <table class="table table-striped table-condensed small margin-bottom-none">
              <thead>
                <tr>
                    <th width="30%">Funder</th>
                    <th width="10%">Type</th>
                    <th class="text-center" width="15%">Amount</th>
                    <th class="text-center" width="10%">Currency</th>
                    <th class="text-center" width="15%">Xrate to default</th>
                    <th class="text-center" width="20%">Amount default</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let funder of project.funding">
                  <td>{{funder.funder}}</td>
                  <td>{{funder.fundType}}</td>
                  <td class="text-center">{{funder.amount}}</td>
                  <td class="text-center">{{funder.currency}}</td>
                  <td class="text-center">{{funder.exchangeRateToDefault}}</td>
                  <td class="text-center">{{funder.amountInDefault}}</td>
                </tr>
                <tr>
                  <td colspan="6">&nbsp;</td>
                </tr>
              </table>

              <table class="table table-condensed small">
                <tr>
                  <td class="bold-italic">Project start</td>
                  <td class="bold-italic">{{project.startDateString}}</td>
                  <td class="bold-italic">Project end</td>
                  <td class="bold-italic">{{project.endDateString}}</td>
                  <td class="bold-italic">Total months</td>
                  <td class="bold-italic">{{project.totalMonths}}</td>
                </tr>
                <tr *ngFor="let share of project.fundShares">
                  <td class="bold-italic">{{share.fundingType}} share</td>
                  <td class="bold-italic">{{share.amount}}</td>
                  <td class="bold-italic">{{share.percentage}}%</td>
                </tr>
              </tbody>
            </table>

            <h5 class="small"><b>Project disbursements</b></h5>
            <table class="table table-striped small">
              <tr>
                <th width="15%">Date</th>
                <th class="text-center" width="20%">Amount</th>
                <th class="text-center" width="15%">Currency</th>
                <th class="text-center" width="20%">Xrate to default</th>
                <th class="text-center" width="30%">Amount default</th>
              </tr>
              <tbody>
                <tr *ngFor="let disbursement of project.disbursements">
                  <td>{{getLongDateString(disbursement.dated)}}</td>
                  <td class="text-center">{{disbursement.amount}}</td>
                  <td class="text-center">{{disbursement.currency}}</td>
                  <td class="text-center">{{disbursement.exchangeRateToDefault}}</td>
                  <td class="text-center">{{disbursement.amountInDefault}}</td>
                </tr>
              </tbody>
            </table>

            <table class="table table-striped small">
              <thead>
                <tr>
                    <th>&nbsp;</th>
                    <th *ngFor="let yr of project.yearlyDisbursements">
                      <b>{{yr.year}}</b>
                    </th>
                </tr>
              </thead>
              <tbody>
                  <tr>
                      <td><b>Active months per year</b></td>
                      <td *ngFor="let yr of project.yearlyDisbursements">
                        {{yr.activeMonths}}
                      </td>
                  </tr>
                  <tr>
                      <td><b>Actual disbursements</b></td>
                      <td *ngFor="let yr of project.yearlyDisbursements">
                          {{yr.disbursements}}
                      </td>
                  </tr>
                  <tr>
                      <td><b>Expected disbursements</b></td>
                      <td *ngFor="let yr of project.yearlyDisbursements">
                          {{yr.expectedDisbursements}}
                      </td>
                  </tr>
              </tbody>
            </table>

            <table class="table table-striped small">
              <tbody>
                <tr>
                  <td><b>{{getCurrentYear()}} active months</b></td>
                  <td>{{project.monthsCurrentYear}}</td>
                </tr>
                <tr>
                  <td><b>Months left</b></td>
                  <td>{{project.monthsLeft}}</td>
                </tr>
                <tr>
                  <td><b>Money previous 2 years</b></td>
                  <td>{{project.moneyPreviousTwoYears}}</td>
                </tr>
                <tr>
                  <td><b>Money left for the remaining years</b></td>
                  <td>{{project.moneyLeftForYears}}</td>
                </tr>
                <tr>
                    <td><b>Expected minus actual for {{getCurrentYear()}}</b></td>
                    <td>{{project.expectedMinusActual}}</td>
                  </tr>
              </tbody>
            </table>
            <br />
          </div>
        </div>
    
      </div>
    </div>

  </block-ui>
</div>

<error-modal message={{errorMessage}}></error-modal>